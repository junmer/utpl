define(function () {
	var a = function () {}, b = {}, c = Array.prototype,
		d = c.slice,
		e = c.forEach,
		f = Object.keys,
		g = a.each = a.forEach = function (c, d, f) {
			if (null != c)
				if (e && c.forEach === e) c.forEach(d, f);
				else
			if (c.length === +c.length) {
				for (var g = 0, h = c.length; h > g; g++)
					if (d.call(f, c[g], g, c) === b) return
			} else
				for (var i = a.keys(c), g = 0, h = i.length; h > g; g++)
					if (d.call(f, c[i[g]], i[g], c) === b) return
		};
	a.keys = f || function (b) {
		if (b !== Object(b)) throw new TypeError("Invalid object");
		var c = [];
		for (var d in b) a.has(b, d) && c.push(d);
		return c
	}, a.invert = function (b) {
		for (var c = {}, d = a.keys(b), e = 0, f = d.length; f > e; e++) c[b[d[e]]] = d[e];
		return c
	}, a.defaults = function (a) {
		return g(d.call(arguments, 1), function (b) {
			if (b)
				for (var c in b) void 0 === a[c] && (a[c] = b[c])
		}), a
	};
	var h = {
		escape: {
			"&": "&amp;",
			"<": "&lt;",
			">": "&gt;",
			'"': "&quot;",
			"'": "&#x27;"
		}
	};
	h.unescape = a.invert(h.escape);
	var i = {
		escape: new RegExp("[" + a.keys(h.escape).join("") + "]", "g"),
		unescape: new RegExp("(" + a.keys(h.unescape).join("|") + ")", "g")
	};
	a.each(["escape", "unescape"], function (b) {
		a[b] = function (a) {
			return null == a ? "" : ("" + a).replace(i[b], function (a) {
				return h[b][a]
			})
		}
	}), a.templateSettings = {
		evaluate: /<%([\s\S]+?)%>/g,
		interpolate: /<%=([\s\S]+?)%>/g,
		escape: /<%-([\s\S]+?)%>/g
	};
	var j = /(.)^/,
		k = {
			"'": "'",
			"\\": "\\",
			"\r": "r",
			"\n": "n",
			"	": "t",
			"\u2028": "u2028",
			"\u2029": "u2029"
		}, l = /\\|'|\r|\n|\t|\u2028|\u2029/g;
	return a.template = function (b, c, d) {
		var e;
		d = a.defaults({}, d, a.templateSettings);
		var f = new RegExp([(d.escape || j).source, (d.interpolate || j).source, (d.evaluate || j).source].join("|") + "|$", "g"),
			g = 0,
			h = "__p+='";
		b.replace(f, function (a, c, d, e, f) {
			return h += b.slice(g, f).replace(l, function (a) {
				return "\\" + k[a]
			}), c && (h += "'+\n((__t=(" + c + "))==null?'':_.escape(__t))+\n'"), d && (h += "'+\n((__t=(" + d + "))==null?'':__t)+\n'"), e && (h += "';\n" + e + "\n__p+='"), g = f + a.length, a
		}), h += "';\n", d.variable || (h = "with(obj||{}){\n" + h + "}\n"), h = "var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n" + h + "return __p;\n";
		try {
			e = new Function(d.variable || "obj", "_", h)
		} catch (i) {
			throw i.source = h, i
		}
		if (c) return e(c, a);
		var m = function (b) {
			return e.call(this, b, a)
		};
		return m.source = "function(" + (d.variable || "obj") + "){\n" + h + "}", m
	}, a
});